<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" 
"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>

<title>Spice Telephony Management</title>

<link rel="stylesheet" href="/dojo/dijit/themes/tundra/tundra.css">

<style type="text/css">
	@import "/dojo/dijit/themes/nihilo/nihilo.css";
	.statusdisplay {
		padding:1.5em
	}

	label{
		width: 10em;
		float: left;
		text-align:right;
		margin-right:0.1em;
		display:block;
		font-weight:bold;
		clear:both;
	}
</style>    

<!-- load the dojo toolkit base -->
<script type="text/javascript" src="/dojo/dojo/dojo.js"
	djConfig="parseOnLoad:true, isDebug:false"></script>
<script type="text/javascript">
/* dependancies */
dojo.require("dijit.Dialog");
dojo.require("dijit.layout.LayoutContainer");
dojo.require("dijit.layout.ContentPane");
dojo.require("dijit.layout.TabContainer");
dojo.require("dijit.form.Button");
dojo.require("dijit.form.Form");
dojo.require("dijit.form.TextBox");
dojo.require("dijit.form.ValidationTextBox");
dojo.require("dijit.form.Textarea");
dojo.require("dijit._tree.dndSource");
dojo.require("dijit.Tree");
dojo.require("dojo.data.ItemFileWriteStore");
dojo.require("dojo.data.ItemFileReadStore");
dojo.require("dojox.encoding.digests.MD5");
dojo.require("dijit.layout.BorderContainer");
dojo.require("dijit.layout.StackContainer");
dojo.require("dijit.form.NumberTextBox");
dojo.require("dijit.form.CheckBox");
dojo.require("dijit.form.FilteringSelect");
dojo.require("dijit.form.MultiSelect");
dojo.require("dijit.Declaration");
dojo.registerModulePath("spice", "../../spice");
dojo.registerModulePath("spice.agents","../../spice/agents");
dojo.registerModulePath("spice.skills", "../../spice/skills");
dojo.registerModulePath("spice.queues", "../../spice/queues");
dojo.registerModulePath("spice.PredicateEditor", "../../spice/PredicateEditor");
dojo.require("spice.agents");
dojo.require("spice.skills");
dojo.require("spice.queues");
dojo.require("spice.PredicateEditor");
</script>
<script type="text/javascript" src="main.js"></script>
</head>

<body class="tundra">

<div dojoType="dijit.Dialog" title="Login" id="loginpane">
	<div dojoType="dijit.form.Form" id="loginform" jsId="loginform" action="/login" method="post">
		<p  id="loginerrp" style="font-size:smaller;display:none"><label>&nbsp;</label><span id="loginerrspan" style="color:#ff0000"></span></p>
		<p><label for="username">Username:</label>
			<input type="text" name="username" value="" dojoType="dijit.form.TextBox" trim="true" id="username" />
		</p>
		<p><label for="password">Password:</label>
			<input type="password" name="password" value="" dojoType="dijit.form.TextBox" id="password" />
		</p>
		
		<p><label for="loginsubmit">&nbsp;</label>
			<button dojoType="dijit.form.Button" id="loginsubmit" type="submit">Login</button>
		</p>
	</div>
</div>

<div id="main" dojoType="dijit.layout.TabContainer" style="width:100%;height:600px;visibility:hidden">
	<div id="agentsTab" dojoType="dijit.layout.BorderContainer" title="Agents" selected="true">
		<div dojoType="dijit.layout.ContentPane" region="leading" width="20%" id="agentsNav">
			<div dojoType="dijit.layout.ContentPane" layoutAlign="top">
				<button dojoType="dijit.form.Button" label="Agents Settings" onclick="dijit.byId('agentsMain').selectChild('agentModuleSettings');
						agents.getModules(dijit.byId('editAgentModuleForm'));"></button>
			</div>
			
			<div style="width:100%;height: 85%;">
				<div id="agentsList" style="width:100%;height: 85%;"></div>
			</div>
			<div dojoType="dijit.layout.ContentPane" layoutAlign="bottom">
				<button dojoType="dijit.form.Button" label="+"
					onclick="
						dijit.byId('editAgent').reset();
						dijit.byId('agentSubmit').onClick = function(){
							agents.newAgent('editAgent', 'agentsList');
						}
						dijit.byId('agentsMain').selectChild('agentEditor')"></button>
				<button dojoType="dijit.form.Button" label="+ Profile" 
				onclick="
					dijit.byId('editAgentProfileForm').reset(); 
					dijit.byId('agentProfileSubmit').onClick = function(){
						agents.newProfile('editAgentProfileForm', 'agentsList');
					};
					dijit.byId('agentsMain').selectChild('agentProfileEditor');
					dijit.byId('agentProfileName').setDisabled(false);"></button>
				<button dojoType="dijit.form.Button" label="-" id="agentsDestroyButton"></button>
			</div>

		</div>
		
		<div dojoType="dijit.layout.StackContainer" region="center" id="agentsMain">
			<div dojoType="dijit.layout.ContentPane" id="agentModuleSettings">
				<form dojoType="dijit.form.Form" id="editAgentModuleForm" action="javascript:void(0)" method="post">
					<p>
						<label for="agentModuleTCPListenEnabled">&nbsp;</label>
						<input id="agentModuleTCPListenEnabled" name="agentModuleTCPListenEnabled" dojoType="dijit.form.CheckBox" value="tcpEnabled" checked onChange="dijit.byId('agentModuleTCPListen').setAttribute('disabled', !this.checked)" />Enable Agent TCP Server
					</p>
					<p>
						<label for="agentModuleTCPListen">TCP Port:</label>
						<input id="agentModuleTCPListen" dojoType="dijit.form.NumberTextBox" name="agentModuleTCPListen" constraints="{min:1024,max:49151,places:0}", required="true", invalidMessage="Not a valid port to bind to.">
					</p>
					<p>
						<label for="agentModuleWebListenEnabled">&nbsp;</label>
						<input id="agentModuleWebListenEnabled" name="agentModuleWebListenEnabled" dojoType="dijit.form.CheckBox" value="webEnabled" checked onChange="dijit.byId('agentModuleWebListen').setAttribute('disabled', !this.checked)" />Enable Agent Web Server
					</p>
					<p>
						<label for="agentModuleWebListen">Web Port:</label>
						<input id="agentModuleWebListen" dojoType="dijit.form.NumberTextBox" name="agentModuleWebListen" constraints="{min:1024,max:49151,places:0}", required="true", invalidMessage="Not a valid port to bind to.">
					</p>
					<p>
						<label for="agentModuleSubmit">&nbsp;</label>
						<button dojoType="dijit.form.Button" label="Submit" onClick="agents.updateModule('editAgentModuleForm')"></button>
					</p>
				</form>
			</div>
			
			<div dojoType="dijit.layout.ContentPane" id="agentEditor">
				<form dojoType="dijit.form.Form" id="editAgent" action="javascript:void(0)" method="post">
				<input type="hidden" dojoType="dijit.form.TextBox" name="oldlogin" id="agentOldLogin" value="" />
				<p>
					<label for="agentLogin">Login Name:</label>
					<input dojoType="dijit.form.TextBox" name="login" id="agentLogin" />
				</p>
				<p>
					<label for="agentIntegrated">Last Integrated:</label>
					<span id="agentIntegrated">undefined</span>
				</p>
				<p>
					<label for="agentPassword">Password:</label>
					<input dojoType="dijit.form.TextBox" type="password" id="agentPassword" name="password" />
				</p>
				<p>
					<label for="agentConfirm">Confirm Password:</label>
					<input dojoType="dijit.form.TextBox" type="password" id="agentConfirm" name="confirm" />
				</p>
				<p>
					<label for="agentProfile">Profile:</label>
					<input dojoType="dijit.form.FilteringSelect" id="agentProfile" name="profile" store="agents.store" value="Default" searchAttr="name" query="{type:'profile'}"/>
				</p>
				<p>
					<label for="agentSecurity">Security level:</label>
					<select dojoType="dijit.form.FilteringSelect" id="agentSecurity" name="security">
						<option value="agent" title="Can have media routed to them">Agent</option>
						<option value="supervisor" title="Agent + can route media and view agent states.">Supervisor</option>
						<option value="admin" title="Supervisor + can access managment interface">Admin</option>
					</select>
				</p>
				<p>
					<label for="agentSkills">Skills:</label>
					<div id="agentSkills">
						<select dojoType="dijit.form.MultiSelect" id="agentSkills" name="skills" size="10" multiple="true"></select>
					</div>
				</p>
				<p>
					<label for="agentSubmit">&nbsp;</label>
					<button dojoType="dijit.form.Button" label="Submit" id="agentSubmit" onClick="agents.updateAgent('editAgent', 'agentsList')"></button>
				</p>
				</form>
			</div>
			
			<div dojoType="dijit.layout.ContentPane" id="agentProfileEditor">
				<form dojoType="dijit.form.Form" id="editAgentProfileForm" action="javascript:void(0)" method="post">
					<input type="hidden" dojoType="dijit.form.TextBox" name="oldname" id="agentProfileOldName" value="" />
					<p>
						<label for="agentProfileName">Profile Name:</label>
						<input dojoType="dijit.form.TextBox" name="name" id="agentProfileName" />
					</p>
					<p>
						<label for="agentProfileSkills">Skills:</label>
						<div id="agentProfileSkills">
							<select dojoType="dijit.form.MultiSelect" id="agentProfileSkills" name="skills" size="10" multiple="true"></select>
						</div>
					</p>
					<p>
						<label for="agentProfileSubmit">&nbsp;</label>
						<button dojoType="dijit.form.Button" label="Submit" id="agentProfileSubmit" onClick="agents.updateProfile('editAgentProfileForm', 'agentsList')"></button>
					</p>
				</form>
			</div>
			
		</div>
	</div>
	
	<div id="queuesTab" dojoType="dijit.layout.BorderContainer" title="Queues">
		<div dojoType="dijit.layout.ContentPane" region="leading" width="20%" id="queuesNav">
			<div style="width:100%;height: 92%">
				<div id="queuesList"></div>
			</div>
			
			<div dojoType="dijit.layout.ContentPane" layoutAlign="bottom">
				<button dojoType="dijit.form.Button" label="+"></button>
				<button dojoType="dijit.form.Button" label="+ Group"></button>
				<button dojoType="dijit.form.Button" label="-"></button>
			</div>
		</div>
		
		<div dojoType="dijit.layout.StackContainer" region="center" id="queuesMain">
			
			<div dojoType="dijit.layout.ContentPane" id="queueGroupEditor">
				<form dojoType="dijit.form.Form" id="editQueueGroupForm" action="javascript:void(0)" method="post">
				<input type="hidden" dojoType="dijit.form.TextBox" name="oldname" id="queueGroupOldName" value="" />
				<p>
					<label for="queueGroupName">Name:</label>
					<input dojoType="dijit.form.TextBox" name="name" id="queueGroupName" />
				</p>
				
				<p>
					<label for="queueGroupSort">Sort:</label>
					<input dojoType="dijit.form.NumberTextBox" name="sort" id="queueGroupSort" />
				</p>
				
				<p>
					<label for="queueGroupSubmit">&nbsp;</label>
					<button dojoType="dijit.form.Button" label="Submit" onClick="console.log('submit')"></button>
				</p>
				</form>
				<p>
					<label for="queueGroupRecipe">Recipe:</label>
					<div dojoType="PredicateEditorRow" id="queueGroupRecipe" store="queues.recipeBuilderStore"></div>
				</p>
			</div>
			
			<div dojoType="dijit.layout.ContentPane" id="queueEditor">
				Queue Editor
			</div>

		</div>
	<!--		<div dojoType="dijit.layout.ContentPane" layoutAlign="client" id="queuePane">
				<div id="editQueueGroupPane" dojoType="dijit.layout.ContentPane" style="display:none;">
					Edit Queue Group
				</div>
				<div id="editQueuePane" dojoType="dijit.layout.ContentPane" style="display:none;">
					Edit Queue
				</div>
				<div id="editQueueGeneralPane" dojoType="dijit.layout.ContentPane">
					General Settings
				</div>
			</div>
			<div dojoType="dijit.layout.ContentPane" layoutAlign="left"
				style="width: 200px;">
				<button dojoType="dijit.form.Button" id="generalQueueSettings">General Settings</button>
				<div dojoType="dojo.data.ItemFileReadStore" url="/queues" jsId="queueTreeStore"></div>

				<div dojoType="dijit.tree.ForestStoreModel"
					store="queueTreeStore"
					rootLabel="Skills"
					jsId="queueTreeModel"></div>

				<div dojoType="dijit.Tree" 
					model="queueTreeModel" 
					id="queueTree"
					showRoot="false"
					style="width:100%;height: 85%;"
					persist="false"></div>
				<div dojoType="dijit.layout.ContentPane" layoutAlign="bottom">
					<button dojoType="dijit.form.Button" id="addQueue">+</button>
					<button dojoType="dijit.form.Button" id="addQueueGroup">+Group</button>
					<button dojoType="dijit.form.Button" id="removeQueue">-</button>
				</div>
			</div>
		</div>-->
	</div>

	<div id="skillsTab" dojoType="dijit.layout.BorderContainer" title="Skills">
		<div dojoType="dijit.layout.ContentPane" region="leading" width="20%" id="skillsNav">
			<div style="width:100%;height:92%">
				<div id="skillsList"></div>
			</div>
			
			<div dojoType="dijit.layout.ContentPane" layoutAlign="bottom">
				<button dojoType="dijit.form.Button" label="+"
					onclick="
						dijit.byId('skillsMain').selectChild('skillEditor');
						dijit.byId('editSkill').reset();
						dijit.byId('skillAtom').setDisabled(false);
						dijit.byId('skillSubmit').onClick = function(){
							skills.newSkill('editSkill', 'skillsList');
						}
					"></button>
			</div>

		</div>
		
		<div dojoType="dijit.layout.StackContainer" region="center" id="skillsMain">
			<div id="skillEditor" dojoType="dijit.layout.ContentPane">
				<form dojoType="dijit.form.Form" id="editSkill" action="javascript:void(0)" method="post">
					<p>
						<label for="skillName">Name:</label>
						<input dojoType="dijit.form.TextBox" name="name" id="skillName" />
					</p>
					
					<p>
						<label for="skillAtom">Atom:</label>
						<input dojoType="dijit.form.TextBox" name="atom" id="skillAtom" disabled />
					</p>
					
					<p>
						<label for="skillGroup">Group:</label>
						<input dojoType="dijit.form.ComboBox" name="group" id="skillGroup" store="skills.store" searchAttr="name" query="{type:'group'}"/>
					</p>
					
					<p>
						<label for="skillDesc">Description:</label>
						<textarea dojoType="dijit.form.Textarea" name="description" id="skillDesc" style="width:400px"></textarea>
					</p>
					
					<p>
						<label for="skillSubmit">&nbsp;</label>
						<button dojoType="dijit.form.Button" label="Submit" id="skillSubmit" onClick="skills.updateSkill('editSkill', 'skillsList')"></button>
					</p>
				</form>
			</div>
			
			<div id="skillGroupEditor" dojoType="dijit.layout.ContentPane">
				<ul>
					<li>To create a skill group, give a skill a group that does not exist.</li>
					<li>A group is automatically deleted when there are no skills in it.</li>
				</ul>
				<form dojoType="dijit.form.Form" id="editSkillGroupForm" action="javascript:void(0)" method="post">
					<input type="hidden" dojoType="dijit.form.TextBox" name="oldname" id="skillGroupOldName" value="" />
					<p>
						<label for="skillGroupName">Group Name:</label>
						<input dojoType="dijit.form.TextBox" name="name" id="skillGroupName" />
					</p>
					<p>
						<label for="skillGroupSubmit">&nbsp;</label>
						<button dojoType="dijit.form.Button" label="Submit" id="skillGroupSubmit" onClick="skills.updateGroup('editSkillGroupForm', 'skillsList')"></button>
					</p>
				</form>
			</div>
		</div>
		<!--<div dojoType="dijit.layout.LayoutContainer" style="width: 100%; height: 100%; padding: 0; margin: 0; border: 0;">
			<div dojoType="dijit.layout.ContentPane" layoutAlign="client" id="skillPane">
				<div id="editSkillGroupPane" dojoType="dijit.layout.ContentPane" style="display:none;">
					Edit Skill Group
				</div>
				<div id="editSkillPane" dojoType="dijit.layout.ContentPane" style="display:none;">
					<form dojoType="dijit.form.Form" id="editSkillForm" action="setskill" method="post">
						<p><label for="skillatom">Skill atom:</label><input type="text" name="skillatom" id="skillAtom" value=""
						dojoType="dijit.form.ValidationTextBox"
						regExp="[_a-z0-9]+"
						required="true"
						invalidMessage="Atoms can only consist of lowercase characters, underscores and numbers."/></p>
						<p><label for="skillName">Name:</label><input type="text" name="skillname" id="skillName" value=""
						dojoType="dijit.form.TextBox"
						trim="true"
						propercase="true" /></p>
						<p><label for="skilldesc">Description:</label><input type="text" name="skilldesc" id="skillDesc" value=""
						dojoType="dijit.form.TextBox"
						trim="true"
						propercase="true" /></p>
						<p><label>&nbsp;</label><button dojoType="dijit.form.Button" id="bsetskill" onclick="setSkill">Edit Skill</button></p>
					</form>
				</div>
			</div>
			<div dojoType="dijit.layout.ContentPane" layoutAlign="left"
				style="width: 200px;">
				<div dojoType="dojo.data.ItemFileWriteStore" url="/skills" jsId="treeStore"></div>

				<div dojoType="dijit.tree.ForestStoreModel"
					store="treeStore"
					rootLabel="Skills"
					jsId="treeModel"></div>

				<div dojoType="dijit.Tree" 
					model="treeModel" 
					id="itemTree"
					showRoot="false"
					style="width:100%; height: 92%;"
					checkAcceptance="skillDragCheckAcceptance"
					checkItemAcceptance="skillDragCheckItemAcceptance"
					dndController="dijit._tree.dndSource"
					persist="false"></div>
				<div dojoType="dijit.layout.ContentPane" layoutAlign="bottom">
					<button dojoType="dijit.form.Button" id="addSkill">+</button>
					<button dojoType="dijit.form.Button" id="addSkillGroup">+Group</button>
					<button dojoType="dijit.form.Button" id="removeSkill">-</button>
				</div>
			</div>
		</div>-->
	</div>
	<div id="mediaTab" dojoType="dijit.layout.ContentPane" title="Media Types">This is the media tab</div>
</div>
</body>
</html>
