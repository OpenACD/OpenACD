<script type="text/javascipt">
	dojo.require("dojox.widget.FisheyeLite");
	dojo.require("dojo.fx");
	dojo.require("dijit.layout.LayoutContainer");
</script>

<div dojoType="dijit.layout.ContentPane" id="supervisorMain">
	<style type="text/css">
		#nodeDisp {
			text-align:center;
			overflow:visible;
			/*float:left;
			position:absolute;
			left:50%*/
		}
		.agentDisp {
			float:right;
		}
		.queueDisp {
			float:left
		}
		span.expander {
			display:block;
			margin:5px;
			width:150px;
			height:20px
		}
		span.nodeTarg {
			margin:10px;
			padding:3px;
			line-height:22px;
			font:10px Arial,sans-serif;
			height: 50px;
			width: 50px;
			background-color:black;
			display:inline-block
		}
	</style>
	
	<div style="float:left;width:40%">
	
		<div id="agentProfileDisp" class="agentDisp" dojoType="dijit.layout.LayoutContainer">
			<script type="dojo/method" event="postCreate">
				var t = this;
				this.buildSubscription = dojo.subscribe("supervisor/agent_profiles", function(node, profiles){
					t.destroyDescendants();
					dojo.forEach(profiles, function(profile){
						var whenclicked = function(e){
							supervisorTab.pollProfile(node, profile.name)
						};
						var actor = document.createElement('span');
						actor.style.backgroundColor = '#ff33cc';
						actor.className = 'expander';
						actor.innerHTML = profile.name + " (" + profile.count + ")";
						var f = new dojox.widget.FisheyeLite({
							properties: {
								height: 1.5,
								width: 1.5
							},
							easeOut: dojo.fx.easing.quadInOut,
							durationOut: 500,
							onClick: whenclicked
						}, actor);
						t.addChild(f);
					});
				});
			</script>
		</div>

		<div id="agentDisp" class="agentDisp" dojoType="dijit.layout.LayoutContainer">
			<script type="dojo/method" event="postCreate">
				var t = this;
				this.clearSubscriptions = [];
				this.clearSubscriptions.push(dojo.subscribe("supervisor/agent_profiles", function(){
					t.destroyDescendants();
				}));
				this.buildSubscription = dojo.subscribe("supervisor/agent/profile", function(node, agents){
					//t.destroyDescendants();
					dojo.forEach(agents, function(agent){
						var whenclicked = function(e){
							supervisorTab.pollAgentCall(node, agent.login);
						};
						var actor = document.createElement('span');
						actor.style.backgroundColor = '#ff6699';
						actor.className = 'expander';
						actor.innerHTML = agent.login;
						var f = new dojox.widget.FisheyeLite({
							properties: {
								height: 1.5,
								width: 1.5
							},
							easeOut: dojo.fx.easing.quadInOut,
							durationOut: 500,
							onClick: whenclicked
						}, actor);
						t.addChild(f);
					});
				});
			</script>
		</div>
		
	</div>

	
	<div style="float:right;width:40%">
		<div id="queueDisp" class="queueDisp" dojoType="dijit.layout.LayoutContainer">
			<script type="dojo/method" event="postCreate">
				var t = this;
				this.buildSubscription = dojo.subscribe("supervisor/queues", function(node, queues){
					t.destroyDescendants();
					dojo.forEach(queues, function(queue){
						var whenclicked = function(e){
							supervisorTab.pollQueue(node, queue.name);
						};
						var actor = document.createElement('span');
						actor.style.backgroundColor = '#3399ff';
						actor.className = 'expander';
						actor.innerHTML = queue.name + "(" + queue.count + ")";
						var f = new dojox.widget.FisheyeLite({
							properties: {
								height: 1.5,
								width: 1.5
							},
							easeOut: dojo.fx.easing.quadInOut,
							durationOut: 500,
							onClick: whenclicked
						}, actor);
						t.addChild(f);
					});
				});
			</script>
		</div>
		
		<div id="queueDetailDisp" dojoType="dijit.layout.LayoutContainer">
			<script type="dojo/method" event="postCreate">
				var t = this;
				this.clearSubscriptions = [];
				this.clearSubscriptions.push(dojo.subscribe("supervisor/node/poll", function(){
					t.destroyDescendants();
				}));
				this.clearSubscriptions.push(dojo.subscribe("supervisor/queues", function(){
					t.destroyDescendants();
				}));
				this.buildSubscription = dojo.subscribe("supervisor/queue", function(queue, details){
					//t.destroyDescendants();
					dojo.forEach(details.calls, function(call){
						var actor = document.createElement('span');
						actor.style.backgroundColor = '#99ccff';
						actor.className = 'expander';
						actor.innerHTML = call.id;
						var f = new dojox.widget.FisheyeLite({
							properties: {
								height: 1.5,
								width: 1.5
							},
							easeOut: dojo.fx.easing.quadInOut,
							durationOut: 500
						}, actor);
						t.addChild(f);
					});
				});
			</script>
		</div>
	</div>
	
	<div style="width:150px;display:inline-block">
		<div id="nodeDisp" dojoType="dijit.layout.LayoutContainer">
			<script type="dojo/method" event="postCreate">
				var t = this;
				this.nodeSubscription = dojo.subscribe("supervisor/node/poll", function(names){
					names.splice(0, 0, "all");
					t.destroyDescendants();
					dojo.forEach(names, function(name){
						var whenclicked = function(e){
							supervisorTab.pollAgentProfiles(name);
							supervisorTab.pollQueues(name);
						};
						var actor = document.createElement('span');
						actor.style.backgroundColor = '#33ff99';
						actor.className = 'expander';
						actor.innerHTML = name;
						var f = new dojox.widget.FisheyeLite({
							properties: {
								height: 1.5,
								width: 1.5
							},
							easeOut: dojo.fx.easing.quadInOut,
							durationOut: 500,
							onClick: whenclicked
						}, actor);
						t.addChild(f);
					});
				});
				supervisorTab.pollNodes();
			</script>
		</div>
	</div>

</div>

<script type="text/javascript" src="tabs/supervisor.js"></script>
